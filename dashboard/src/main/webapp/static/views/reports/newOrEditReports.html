<style>
    .image-upload img{
        max-width: 200px;
        max-height: 125px;
        display: block;
        cursor: pointer;
    }
    .image-upload > input
    {
        display: none;
    }
    .content-report {
        /*padding-top:30px;*/
    }
</style>
<div>
    <div class="pull-right">
        <span class="dropdown" style="cursor: pointer;">
            <a class="dropdown-toggle" type="button" data-toggle="dropdown">
                <i class="fa fa-plus"></i> Add Widget
            </a>
            <ul class="dropdown-menu">
                <li>
                    <a href="" ng-click="addReportWidget('2')"><i class="fa fa-square-o"></i><i class="fa fa-square-o"></i><i class="fa fa-square-o"></i></a>
                </li>
                <li>
                    <a href="" ng-click="addReportWidget('4')"><i class="fa fa-square-o"></i><i class="fa fa-square-o"></i></a>
                </li>
                <li>
                    <a href="" ng-click="addReportWidget('6')"><i class="fa fa-square-o"></i></a>
                </li>
            </ul>
        </span> | 
        <span style="cursor: pointer;">Print</span> |
        <span ui-sref="index.report.reports" style="cursor: pointer;">Back</span>
    </div>
    <div class="row"> 
        <div class="col-md-12">
            <div class="col-sm-2">
                <div class="image-upload">
                    <label for="file-input">
                        <img class="img-responsive img-thumbnail" ng-src="{{uploadLogo}}"/>
                    </label>

                    <input id="file-input" type="file" ng-model-instant onchange="angular.element(this).scope().imageUpload(event)"/>
                </div>
            </div>
            <div class="col-sm-10">
                <div class="form-group">
                    <input type="text" ng-model="report.title" class="form-control" placeholder="Title">
                </div>
                <div class="form-group">
                    <textarea placeholder="Description" ng-model="report.description" class="form-control"></textarea>
                </div>                
            </div>
            <div class="col-sm-12">
                <button class="btn btn-info" ng-click="saveReport(report)"></button>
            </div>
        </div>
    </div>
    <div class="row">
        <div ng-repeat="reportWidget in reportWidgets">
            <div class="col-md-{{2 * reportWidget.width}} ">
                <div class="box box-primary" ng-hide="hidenewchart" ngsf-fullscreen="widgetCtrl">
                    <div class="box-header with-border">
                        <h3 class="box-title">
                            <span class="{{reportWidget.icon}}"></span> 
                            <span class="text-capitalize">{{reportWidget.widgetTitle}}</span>
                        </h3>

                        <div class="box-tools pull-right">
                            <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
                            </button>
                            <button type="button" class="btn btn-box-tool" ng-click="editReportWidget(reportWidget);" data-toggle="modal" data-target="#preview{{reportWidget.id}}"><i class="fa fa-pencil"></i>
                            </button>
                            <button type="button" class="btn btn-box-tool" data-toggle="modal" data-target="#delete{{reportWidget.id}}"><i class="fa fa-times"></i></button>
                            <div id="delete{{reportWidget.id}}" class="modal fade">
                                <div class="modal-dialog modal-lg">
                                    <div class="modal-content">
                                        <div class="modal-header" style="background-color:#9DD6D7;color:black;">
                                            <strong>Delete</strong>
                                            <strong><button class="close" data-dismiss="modal">&times;</button></strong>
                                        </div>
                                        <div class="modal-body">
                                            <span>Want to delete ? </span>
                                        </div>
                                        <div class="modal-footer">
                                            <button class="btn btn-info btn-xs" ng-click="deleteReportWidget(reportWidget, $index)" data-dismiss="modal">Ok</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="box-body chart-responsive" ng-if="reportWidget.chartType === 'line'">
                        <div line-Chart-Directive line-Chart-Url="{{reportWidget.directUrl}}" widget-Columns="{{reportWidget.columns}}"></div>
                    </div> 
                    <div class="box-body chart-responsive" ng-if="reportWidget.chartType === 'bar'">
                        <div bar-Chart-Directive bar-Chart-Url="{{reportWidget.directUrl}}" widget-Columns="{{reportWidget.columns}}"></div>
                    </div> 
                    <div class="box-body chart-responsive" ng-if="reportWidget.chartType === 'pie'">
                        <div pie-Chart-Directive pie-Chart-Url='{{reportWidget.directUrl}}' widget-Columns="{{reportWidget.columns}}"></div>
                    </div> 
                    <div class="box-body chart-responsive" ng-if="reportWidget.chartType === 'area'">
                        <div area-Chart-Directive area-Chart-Url="{{reportWidget.directUrl}}" widget-Columns="{{reportWidget.columns}}"></div>
                    </div> 
                    <div class="box-body" ng-if="reportWidget.chartType === 'table'">
                        <div dynamic-Table dynamic-Table-Url="{{reportWidget.directUrl}}" widget-Id="{{reportWidget.id}}"  widget-Columns="{{reportWidget.columns}}"></div> 
                    </div> 
                </div>
            </div>

            <div id="preview{{reportWidget.id}}" class="modal fade">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <strong>Report</strong>
                            <strong><button class="close" data-dismiss="modal">&times;</button></strong>
                        </div>
                        <div class="modal-body">
                            <form class="form-horizontal">

                                <div class="form-group">
                                    <label class="col-sm-2">Widget Title</label>
                                    <div class="col-sm-4">
                                        <input type="text" class="form-control" ng-model="reportWidget.previewTitle">
                                    </div>
                                    <label class="col-sm-2">Date Duration</label>
                                    <div class="col-sm-4">
                                        <select class="form-control">
                                            <option ng-repeat="selectDateDuration in selectDateDurations" value="{{selectDateDuration.duration}}">{{selectDateDuration.duration}}</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="col-sm-2">Product</label>
                                    <div class="col-sm-4">
                                        <select class="form-control" ng-model="reportWidget.productName" ng-change="selectProductName(reportWidget.productName, reportWidget)" ng-options="(userProduct |              capitalize) for userProduct in userProducts">
                                        </select>                                    
                                    </div>
                                    <label class="col-sm-2">Name</label>
                                    <div class="col-sm-4">
                                        <select class="form-control" ng-model="reportWidget.productDisplayName" ng-change="changeUrl(reportWidget.productDisplayName, reportWidget)">
                                            <option ng-repeat="productField in productFields" value="{{productField}}">{{productField.productDisplayName}}</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="col-sm-2">Type</label>
                                    <div class="col-sm-10 row">
                                        <div class="col-sm-2" ng-repeat="chartType in chartTypes track by chartType.id">
                                            <span ng-click="reportPreviewChart(chartType, reportWidget, $index);" class="previewChart" title="{{chartType.name}}">
                                                <!--<img src="{{chartType.url}}" class="charttype">-->
                                                <i style="cursor: pointer" class="fa {{chartType.icon}}" ng-class="{'selected': chartType.type == (selectedRow?selectedRow:widgetReport.chartType)}"></i>
                                            </span>
                                        </div>
                                    </div>
                                </div> 

                                <div class="form-group">
                                    <label class="col-sm-2">Columns</label>
                                    <div class="col-sm-10">
                                        <button ng-hide="showAddButton" 
                                                ng-disabled="(reportWidget.productName && reportWidget.productDisplayName && (reportWidget.widgetChartType ? reportWidget.widgetChartType : reportWidget.chartType)) ? false : true;" 
                                                class="btn btn-info" ng-click="showFieldTable = true; showAddButton = true;">
                                            <i class="fa fa-plus"></i> Add / Edit
                                        </button>
                                        <button ng-show="showAddButton" 
                                                class="btn btn-info" 
                                                ng-click="showFieldTable = false; showAddButton = false;">
                                            <i class="fa fa-close"></i> Close
                                        </button>
                                    </div>
                                    <div class="col-sm-12">
                                        <div ng-show="showFieldTable" class="table-responsive">  
                                            <table class="table table-bordered table-hover" >
                                                <thead>
                                                    <tr>
                                                        <td>Field Name</td>
                                                        <td>Display Name</td>
                                                        <td ng-if="(reportWidget.widgetChartType ? reportWidget.widgetChartType : reportWidget.chartType) === 'table'">Aggregation Function</td>
                                                        <td ng-if="(reportWidget.widgetChartType ? reportWidget.widgetChartType : reportWidget.chartType) === 'table'">Group Priority</td>
                                                        <td ng-if="(reportWidget.widgetChartType ? reportWidget.widgetChartType : reportWidget.chartType) !== 'table'">X-Axis</td>
                                                        <td ng-if="(reportWidget.widgetChartType ? reportWidget.widgetChartType : reportWidget.chartType) !== 'table'">Y-Axis</td>
                                                        <td>Sort</td>
                                                        <td>Format</td>
                                                        <td ng-if="(reportWidget.widgetChartType ? reportWidget.widgetChartType : reportWidget.chartType) === 'table'">Alignment</td>
                                                        <td><button class="btn btn-info" ng-click="addColumns(reportWidget)"><i class="fa fa-plus"></i></button></td>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr ng-repeat="column in reportWidget.columns">
                                                        <td>
                                                            <div ng-hide="isEdit"> {{column.fieldName}}</div>
                                                            <div ng-show="isEdit">
                                                                <select ng-model="column.fieldName" class="form-control">
                                                                    <option ng-repeat="collectionField in collectionFields" value="{{collectionField.fieldName}}">{{collectionField.displayName}}</option>
                                                                </select>
                                                            </div>
                                                        </td>
                                                        <td>
                                                            <div ng-hide="isEdit"> {{column.displayName}}</div>
                                                            <div ng-show="isEdit">
                                                                <input type="text" class="form-control" ng-model="column.displayName">
                                                            </div>
                                                        </td>
                                                        <td ng-if="(changeTableColumns ? changeTableColumns : editChartType) === 'table'">
                                                            <div ng-hide="isEdit"> {{column.agregationFunction}}</div>
                                                            <div ng-show="isEdit">
                                                                <!--<input type="text" class="form-control" ng-model="column.agregationFunction">-->
                                                                <select ng-model="column.agregationFunction" class="form-control">
                                                                    <option ng-repeat="selectAggregation in selectAggregations" value="{{selectAggregation.name}}">{{selectAggregation.name}}</option>
                                                                </select>
                                                            </div>
                                                        </td>
                                                        <td ng-if="(changeTableColumns ? changeTableColumns : editChartType) === 'table'">
                                                            <div ng-hide="isEdit"> {{column.groupPriority}}</div>
                                                            <div ng-show="isEdit">
                                                                <input type="text" class="form-control" ng-model="column.groupPriority">
                                                            </div>
                                                        </td>
                                                        <td ng-if="(changeTableColumns ? changeTableColumns : editChartType) !== 'table'">
                                                            <div ng-hide="isEdit"> {{column.xAxis}}</div>
                                                            <div ng-show="isEdit">
                                                                <input type="text" class="form-control" ng-model="column.xAxis">
                                                            </div>
                                                        </td>
                                                        <td ng-if="(changeTableColumns ? changeTableColumns : editChartType) !== 'table'">
                                                            <div ng-hide="isEdit"> {{column.yAxis}}</div>
                                                            <div ng-show="isEdit">
                                                                <input type="text" class="form-control" ng-model="column.yAxis">
                                                            </div>  
                                                        </td>
                                                        <td>
                                                            <div ng-hide="isEdit"> {{column.sortOrder}}</div>
                                                            <div ng-show="isEdit">
                                                                <!--<input type="text" class="form-control" ng-model="widget.sortOrder">-->
                                                                <select ng-model="column.sortOrder" class="form-control">
                                                                    <option ng-repeat="sort in sorting" value="{{sort.value}}">{{sort.name}}</option>
                                                                </select>
                                                            </div> 
                                                        </td>
                                                        <td>
                                                            <div ng-hide="isEdit"> {{column.displayFormat}}</div>
                                                            <div ng-show="isEdit">
                                                                <input type="text" class="form-control" ng-model="column.displayFormat">
                                                            </div>
                                                        </td>
                                                        <td ng-if="(changeTableColumns ? changeTableColumns : editChartType) === 'table'">
                                                            <div ng-hide="isEdit"> {{column.alignment}}</div>
                                                            <div ng-show="isEdit">
                                                                <select ng-model="column.alignment" class="form-control">
                                                                    <option ng-repeat="alignment in alignments" value="{{alignment.name}}">{{alignment.name}}</option>
                                                                </select>
                                                            </div>
                                                        </td>
                                                        <td>
                                                            <div ng-show="isEdit">
                                                                <button class="btn btn-default btn-xs" ng-click="isEdit = false"><i class="fa fa-save"></i></button>
                                                                <!--<button class="btn btn-default btn-xs" ng-click="saveColumn(widget, column); widget.isEdit = false"><i class="fa fa-save"></i></button>-->
                                                                <button class="btn btn-default btn-xs" ng-click="isEdit = false"><i class="fa fa-close"></i></button>
                                                                <button class="btn btn-default btn-xs" ng-click="deleteColumn(reportWidget.columns, $index)"><i class="fa fa-trash"></i></button>
                                                            </div>
                                                            <div ng-hide="isEdit">
                                                                <button class="btn btn-default btn-xs" ng-click="isEdit = true"><i class="fa fa-pencil"></i></button>
                                                                <button class="btn btn-default btn-xs" ng-click="deleteColumn(reportWidget.columns, $index)"><i class="fa fa-trash"></i></button>
                                                            </div>
                                                        </td>

                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <div class="col-sm-10">
                                        <button class="btn btn-info" ng-click="showPreview(reportWidget); showPreviewChart = !showPreviewChart">
                                            <i class="fa" ng-class="{'fa-angle-down': !showPreviewChart, 'fa-angle-up': showPreviewChart}"></i> Preview 
                                        </button>
                                    </div>                                    
                                    <div ng-show="showPreviewChart">
                                        <div class="col-md-12">
                                            <div class="box-body chart-responsive" ng-if="previewChartType === 'line'">
                                                <div line-Chart-Url='{{previewChartUrl}}' widget-Columns="{{previewColumn.columns}}" line-Chart-Directive style="min-height:{{reportWidget.minHeight}}"></div>
                                            </div> 
                                            <div class="box-body chart-responsive" ng-if="previewChartType === 'area'">
                                                <div area-Chart-Url='{{previewChartUrl}}' widget-Columns="{{previewColumn.columns}}" area-Chart-Directive style="min-height:{{reportWidget.minHeight}}"></div>
                                            </div> 
                                            <div class="box-body chart-responsive" ng-if="previewChartType === 'bar'">
                                                <div bar-Chart-Url='{{previewChartUrl}}' widget-Columns="{{previewColumn.columns}}" bar-Chart-Directive style="min-height:{{reportWidget.minHeight}}"></div>
                                            </div> 
                                            <div class="box-body chart-responsive" ng-if="previewChartType === 'pie'">
                                                <div pie-Chart-Url='{{previewChartUrl}}' widget-Columns="{{previewColumn.columns}}" pie-Chart-Directive style="min-height:{{reportWidget.minHeight}}"></div>
                                            </div>
                                            <div class="box-body chart-responsive" ng-if="previewChartType === 'table'"  style="overflow: auto;">
                                                <div dynamic-Table dynamic-Table-Url="{{previewChartUrl}}" widget-Id="{{previewColumn.id}}" widget-Columns="{{previewColumn.columns}}"></div>
                                            </div> 
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button data-dismiss="modal" class="btn btn-info" ng-click="saveReport(reportWidget); showFieldTable = false; showPreviewChart = false; showAddButton = false;"><span class="fa fa-save"></span> Save</button>
                            <button data-dismiss="modal" class="btn btn-danger"><span class="fa fa-times"></span> Cancel</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-sm-12">
            <input type="checkbox" ng-model="reportWidget" ng-change="bindData(reportWidget)"> Save as template
        </div>
    </div>
</div>